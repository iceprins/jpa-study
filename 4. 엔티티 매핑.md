# 엔티티 매핑

JPA를 사용하는 데 가장 중요한 일은 엔티티와 테이블을 정확히 매핑하는 것이다.

- 객체와 테이블 매핑: `@Entity`, `@Table`
- 기본 키 매핑: `@Id`
- 필드와 럼 매핑: `@Column`
- 연관관계 매핑: `@ManyToOne`, `@JoinColumn`

## @Entity

> JPA를 사용해서 테이블과 매핑할 클래스는 `@Entity` 어노테이션을 필수로 붙여야 한다. `@Entity`가 붙은 클래스는 JPA가 관리하는 것으로, 엔티티라 부른다.

`@Entity` 적용 시 주의사항은 다음과 같다.

- 기본 생성자는 필수(파라미터가 없는 `public` 또는 `protected` 생성자)
- `final` 클래스, `enum`, `interface`, `inner` 클래스에는 사용 불가
- 저장할 필드에 `final` 사용 불가

```java
public Member() {} // 기본 생성자

// 임의의 생성자
public Member(String name) {
    this.name = name;
}
```

## @Table

> @Table은 엔티티와 매핑할 테이블을 지정한다.

생략하면 매핑한 엔티티 이름을 테이블 이름으로 사용한다.

## 다양한 매핑 사용

```java
package jpabook.start;

import javax.persistence.*;  
import java.util.Date;

@Entity
@Table(name="MEMBER")
public class Member {

    @Id
    @Column(name = "ID")
    private String id;

    @Column(name = "NAME")
    private String username;

    private Integer age;

    // ==추가==
    @Enumerated(EnumType.STRING)
    private RoleType roleType; ❶

    @Temporal(TemporalType.TIMESTAMP)
    private Date createdDate; ❷

    @Temporal(TemporalType.TIMESTAMP)
    private Date lastModifiedDate; ❷

    @Lob
    private String description; ❸

    //Getter, Setter
    ...
}


package jpabook.start;

public enum RoleType {
    ADMIN, USER
}
```

- ❶ `roleType`: 자바의 `enum`을 사용해서 회원의 타입을 구분. 자바의 `enum`을 사용하려면 `@Enumerated` 어노테이션으로 매핑.
- ❷ `createdDate`, `lastModifiedDate`: 자바의 날짜 타입은 @`Temporal`을 사용해서 매핑
- ❸ `description`: 회원을 설명하는 필드는 길이 제한이 없다. 따라서 데이터베이스의 VARCHAR 타입 대신 CLOB 타입으로 저장. `@Lob`을 사용하면 CLOB, BLOB 타입을 매핑 가능

## 데이터베이스 스키마 자동 생성

JPA는 데이터베이스 스키마를 자동으로 생성하는 기능을 지원한다.

```xml
<property name="hibernate.hbm2ddl.auto" value="create" />
```

- 애플리케이션 실행 시점에 데이터베이스 테이블을 자동으로 생성한다.

```xml
<property name="hiberante.show_sql" value="true" />
```

- 콘솔에 실행되는 테이블 생성 DDL을 출력할 수 있다.

```
Hibernate: 
    drop table MEMBER if exists
Hibernate: 
    create table MEMBER (
        ID varchar(255) not null,
        NAME varchar(255),
        age integer,
        roleType varchar(255),
        createdDate timestamp,
        lastModifiedDate timestamp,
        description clob,
        primary key (ID)
    )
```

- 개발자가 테이블을 직접 생성하는 수고를 덜 수 있다.
- 스키마 자동 생성 기능이 만든 DDL은 운영 환경에서 사용할 만큼 완벽하지는 않다.
- 개발 환경에서 사용하거나 매핑을 어떻게 해야 하는지 참고하는 정도로만 사용하는 것이 좋다.

