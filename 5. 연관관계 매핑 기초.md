# 연관관계 매핑 기초

## 단방향 연관관계

#### 객체 연관관계와 테이블 연관관계의 가장 큰 차이

- 객체에서 참조를 통한 연관관계는 언제나 단방향이다. 객체간에 연관관계를 양방향으로 만들고 싶으면 반대쪽에도 필드를 추가해서 참조를 보관해야 한다.
- 테이블은 외래 키 하나로 양방향으로 조인할 수 있다.

```java
// 단방향 연관관계
class A {
    B b;
}
class B {}

// 양방향 연관관계
class A{
    B b;
}
class B {
    A a;
}
```

#### 객체 연관관계 vs 테이블 연관관계 정리

- 객체는 참조(주소)로 연관관계를 맺는다.
- 테이블은 외래 키로 연관관계를 맺는다.

> 연관된 데이터를 조회할 때 객체는 참조를 사용하지만 테이블은 조인을 사용한다.

- 참조를 사용하는 객체의 연관관계는 단방향이다.
- 외래 키를 사용하는 테이블의 연관관계는 양방향이다.
- 객체를 양방향으로 참조하려면 단방향 연관관계를 2개 만들어야 한다.

### 순수한 객체 연관관계

```java
// 회원과 팀 클래스
public class Member {

    private String id;
    private String username;

    private Team team; // 팀의 참조를 보관

    public void setTeam(Team team) {
	this.team = team;
    }

    // Getter, Setter ...
}

public class Team {

    private String id;
    private String name;

    // Getter, Setter ...
}
```

```java
// 동작 코드
public static void main(String[] args) {

    // 생성자(id, 이름)
    Member member1 = new Member("member1", "회원1");
    Member member2 = new Member("member2", "회원2");
    Team team1 = new Team("team1", "팀1");

    member1.setTeam(team1);
    member2.setTeam(team1);

    Team findTeam = member1.getTeam();
}
```

객체는 참조를 사용해서 연관관계를 탐색할 수 있는데 이것을 **객체 그래프 탐색**이라 한다.

### 테이블 연관관계

```sql
CREATE TABLE MEMBER (
    MEMBER_ID VARCHAR(255) NOT NULL,
    TEAM_ID VARCHAR(255),
    USERNAME VARCHAR(255),
    PRIMARY KEY (MEMBER_ID)
)

CREATE TABLE TEAM (
    TEAM_ID VARCHAR(255) NOT NULL,
    NAME VARCHAR(255),
    PRIMARY KEY (TEAM_ID)
)

ALTER TABLE MEMBER ADD CONSTRAINT FK_MEMBER_TEAM
    FOREIGN KEY (TEAM_ID)
    REFERENCES TEAM
```


### 객체 관계 매핑

```java
// 매핑한 회원 엔티티
@Entity
public class Member {

    @Id
    @Column(name = "MEMBER_ID")
    private String id;

    private String username;

    // 연관관계 매핑
    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;

    // 연관관계 설정
    public void setTeam(Team team) {
	this.team = team;
    }

    // Getter, Setter ...
}
```

```java
// 매핑한 팀 엔티티
@Entity
public class Team {

    @Id
    @Column(name = "TEAM_ID")
    private String id;

    private String name;

    // Getter, Setter ...
}
```

`Member.team`과 `MEMBER.TEAM_ID`를 매핑하는 것이 연관관계 매핑이다.

- `@ManyToOne`
	- 다대일(N:1) 관계라는 매핑 정보
	- 연관관계를 매핑할 때 이렇게 다중성을 나타내는 어노테이션을 필수로 사용
- `@JoinColumn(name = "TEAM_ID")`
	- 조인 칼럼은 외래 키를 매핑할 때 사용
	- `name` 속성에는 매핑할 외래 키 이름을 지정
	- 이 어노테이션은 생략 가능

### @JoinColumn

> 외래 키를 매핑할 때 사용한다.

- @JoinColumn을 생략하면 외래 키를 찾을 때 기본 전략을 사용한다.
- 기본 전략: 필드명 + _ + 참조하는 테이블의 칼럼명

### @ManyToOne

다대일 관계에서 사용한다.

```java
@OneToMany
private List<Member> members; // 제네릭으로 타입 정보를 알 수 있다.

@OneToMany(targetEntity = Member.class)
private List members; // 제네릭이 없으면 타입 정보를 알 수 없다.
```
